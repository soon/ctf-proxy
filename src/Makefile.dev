.PHONY: help test lint fmt check install-dev clean test-cov

help:
	@echo "Development commands:"
	@echo "  test        Run all tests"
	@echo "  test-cov    Run tests with coverage"
	@echo "  lint        Run ruff linter"
	@echo "  fmt         Format code with ruff"
	@echo "  check       Run both linting and tests"
	@echo "  install-dev Install development dependencies"
	@echo "  clean       Clean up cache files"

install-dev:
	./uv.sh sync --dev

test:
	./uv.sh run pytest
	cd interceptor/test && make test

test-cov:
	./uv.sh run pytest --cov=ctf_proxy --cov-report=term-missing

lint:
	./uv.sh run ruff check .

fmt:
	./uv.sh run ruff format .
	./uv.sh run ruff check --fix .
	cd interceptor && go fmt
	cd interceptor/test && go fmt

check: lint test

clean:
	find . -type d -name "__pycache__" -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
	rm -rf .coverage
	rm -rf .pytest_cache
	rm -rf htmlcov
